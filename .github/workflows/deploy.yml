name: Deploy to Production

# ── Trigger ────────────────────────────────────────────────
# Runs only when you push to main.
# Work on any other branch freely — it won't deploy until
# you merge/push to main.
on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Sync files to server
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Deploy via rsync over SSH
        uses: easingthemes/ssh-deploy@v5
        with:
          SSH_PRIVATE_KEY: ${{ secrets.SERVER_SSH_KEY }}
          REMOTE_HOST:     ${{ secrets.REMOTE_HOST }}
          REMOTE_USER:     ${{ secrets.REMOTE_USER }}
          TARGET:          ${{ secrets.REMOTE_PATH }}
          # SOURCE defaults to repo root with trailing slash — contents are
          # synced flat into TARGET with no subdirectory created.
          SOURCE: "./"
          # --delete mirrors the repo exactly: files removed from git are
          # removed from the server. Safe because excluded paths are never
          # deleted even with --delete.
          ARGS: "-rlzv --delete --exclude='.git*' --exclude='.github' --exclude='README*'"

